# Changelog
All notable changes to the WindowsMaintScript project will be documented in this file.

## [2.4.0] - 2025-08-16
### Added
- Temp File Cleanup section: Clears `C:\Windows\Temp`, `%TEMP%`, and `C:\Windows\SoftwareDistribution\Download` with user prompt (default "Y").
- Tracks and logs space freed (in MB) and cleanup errors.
- Added cleanup metrics to log analysis summary (errors and MB freed).
- Recommendations for regular cleanups if significant space is freed (>1 GB) or if cleanup errors occur.

## [2.3.0] - 2025-08-16
### Fixed
- Corrected SSD vs. HDD detection by using `Get-Partition` and `Get-Disk` for reliable drive-to-disk mapping, with fallback to `FriendlyName` checks for "SSD" or "NVMe" if `MediaType` is unspecified. Ensures C: and E: (SSDs) and D: (HDD) are identified correctly, avoiding unnecessary defrag prompts on SSDs.

## [2.2.0] - 2025-08-15
### Added
- Drive type detection using `Get-PhysicalDisk` and `Get-Volume` to identify SSDs vs. non-SSDs.
- Conditional defrag prompts: Automatic `defrag /C /O /V` for SSDs (TRIM) without prompt; user prompt (default "N") for non-SSDs (HDDs) with warning about long runtime.
- Drive type logging and inclusion in analysis summary (e.g., "Contig Errors on C: (SSD): 0").

## [2.1.0] - 2025-08-14
### Added
- Expanded Event Log analysis for additional IDs (7, 11, 50, 55, 98, 137, 140, 153, 219, 41, 7023, 2004, 1001, 12289, 12290) covering disk, NTFS, driver, hardware, memory, and VSS issues.
- Hardware checks: SMART status via `Get-PhysicalDisk` and `Get-StorageReliabilityCounter` for disk health (read/write errors, wear).
- Driver checks: Scans for unsigned/problem drivers with `Get-WmiObject Win32_PnPSignedDriver` and runs `pnputil /scan-devices` if issues found.
- Memory checks: Detects pending reboots and offers to schedule Windows Memory Diagnostic (`mdsched.exe`).
- Malware scan: Quick Windows Defender scan (`Start-MpScan -ScanType QuickScan`) with threat detection via Event IDs 1000, 1001.
- Update checks: Scans for failed updates with `Get-HotFix` and runs `wuauclt /detectnow` if needed.
- Dirty volume checks: Uses `fsutil dirty query` to detect and schedule CHKDSK for dirty volumes.
- Free space checks: Warns if drive free space is <10% using `Get-Volume`.
- Recommendations section in analysis based on findings (e.g., "Run full CHKDSK /f /r if disk errors detected").
- Sysinternals Suite download prompt if `contig.exe` is missing.
### Changed
- Renamed script to `EnhancedCombinedSystemMaintenance.ps1` to reflect expanded scope.
- Extended CHKDSK to all NTFS drives, with `/f /sdcleanup` for corrupted drives.
- Enhanced shadow copy maintenance to check and delete corrupted copies across all NTFS drives.
- Improved logging with detailed section outputs and drive-specific information.

## [1.0.0] - 2025-08-01
### Added
- Initial release of `RunSystemMaintenance.ps1`.
- Executes DISM commands (`checkhealth`, `scanhealth`, `restorehealth`, `AnalyzeComponentStore`, `StartComponentCleanup`), SFC (`/scannow`), CHKDSK (`/scan c:`), and Contig (`-v -s <drive>:\$MFT`).
- User confirmation prompts for each command (default "Y").
- Log file creation with hostname and date (e.g., `SystemMaintenanceLog_HOSTNAME_YYYYMMDD.txt`) and rotation.
- Log analysis for `DISM.log`, `CBS.log`, and CHKDSK Event Log (Wininit, Event ID 1001).
- Optional repair source for DISM `/restorehealth`.
- Basic error and repair counting with keyword patterns.