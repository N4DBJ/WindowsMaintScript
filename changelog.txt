# Changelog
All notable changes to the WindowsMaintScript project will be documented in this file.

## [2.5.7] - 2025-08-16
### Fixed
- Resolved DISM command execution error in OS Maintenance Section where `Start-Process` passed the entire command string including "dism" as an argument, causing "Error: 87". Updated `$osCommands` to store only arguments for DISM commands, excluding "dism" prefix, and adjusted `Start-Process` to use the correct argument list.

## [2.5.6] - 2025-08-16
### Fixed
- Resolved `Start-Process` error in OS Maintenance Section where `RedirectStandardOutput` and `RedirectStandardError` used the same temporary file for DISM commands. Now uses separate files for output and error streams, combining them for logging and display.

## [2.5.5] - 2025-08-16
### Added
- Initial System State Check section to detect pending Windows Updates (via `PSWindowsUpdate` module or `Get-HotFix` fallback) and pending restarts (Windows Update, Component-Based Servicing, Pending File Rename Operations, SCCM client).
- Prompts user to restart if pending updates or restarts are detected (default "Y"). If declined, proceeds with warning that results may be affected.
- Logs pending updates (count and details) and restart sources.
- Updated Log Analysis section to include pending updates and restarts in summary.
- Moved pending reboot check from Memory and Update Checks to Initial System State Check.

## [2.5.4] - 2025-08-16
### Added
- Real-time DISM progress display on console using `Write-Progress` for percentage updates (e.g., `[========== 18.1% ]`) during `checkhealth`, `scanhealth`, `restorehealth`, `AnalyzeComponentStore`, and `StartComponentCleanup`.
- Cleaned up DISM log output to exclude repetitive progress lines (e.g., `[========== 18.1% ]`), logging only the final progress percentage (e.g., `[=========== 100.0% ]`) and significant messages (e.g., "The operation completed successfully").
- Added checks for Windows Defender service (WinDefend) status and third-party antivirus software before running `Start-MpScan` to prevent `CimException` (0x800106ba).
- Attempts to start WinDefend if stopped and logs the outcome.
- Checks for third-party antivirus via `Get-CimInstance -Namespace root/SecurityCenter2 -ClassName AntiVirusProduct`.
- Provides recommendations if scan fails (e.g., check Defender status, run `MpCmdRun -SignatureUpdate`, repair system with DISM/SFC).

## [2.5.3] - 2025-08-16
### Fixed
- Fixed PowerShell parsing errors in Shadow Copy Maintenance section by using `${shadowVolume}` for variable substitution in log messages.
- Changed Contig command to remove recursive flag (`-s`) and add `-accepteula` for non-interactive execution.

## [2.5.2] - 2025-08-16
### Added
- Result-driven prompts for DISM commands, asking to proceed only if prior commands indicate issues (e.g., skip `RestoreHealth` if `CheckHealth` finds no corruption).
- On-screen section summaries for each maintenance section (e.g., OS Maintenance, Disk Maintenance) with errors, repairs, and skipped actions.
- Temp file cleanup section for `C:\Windows\Temp`, `%TEMP%`, and `C:\Windows\SoftwareDistribution\Download`, with space freed calculation.
- Improved SSD vs. HDD detection using `Get-PhysicalDisk` MediaType and fallback to FriendlyName pattern matching.

## [2.5.1] - 2025-08-15
### Added
- Support for multiple NTFS drives in disk maintenance, shadow copy checks, and optimization.
- Automatic detection of SSD vs. HDD for tailored defragmentation (`/O` switch for SSD TRIM).
- Optional Sysinternals Suite download and PATH integration if not present.

## [2.5.0] - 2025-08-14
### Added
- Combined multiple maintenance scripts into a single script with sections for TRIM, OS maintenance (DISM/SFC), disk maintenance (CHKDSK/fsutil/Contig), shadow copy maintenance, optimization, hardware/driver checks, memory/update checks, malware scan, and VSS verification.
- Comprehensive logging to a timestamped file with hostname.
- User prompts for each section with default "Y" or "N" based on action.
- Detailed log analysis summarizing errors, repairs, and recommendations.

## [2.0.0] - 2025-08-10
### Added
- Initial release of combined maintenance script with basic DISM, SFC, CHKDSK, and defrag functionality.
- Support for logging and basic error detection.